<!DOCTYPE html>
<html lang="en">
	<%- include('./partials/head.ejs') %>

	<body>
		<%- include('partials/nav'); -%>
		<div class="row justify-content-center">
			<form class="col-6">
				<h1 class="col-10 mx-auto mb-4">Log In</h1>
				<div class="mb-3 col-10 mx-auto">
					<label for="email" class="form-label">Email</label>
					<input type="text" name="email" required class="form-control" />

					<div class="email error"></div>
				</div>
				<div class="mb-3 col-10 mx-auto">
					<label for="password" class="form-label">Password</label>
					<input type="password" name="password" required class="form-control" />
					<div class="password error"></div>
				</div>
				<div class="col-10 mx-auto">
					<button class="btn btn-lg btn-block btn-dark">LOG IN</button>
				</div>
			</form>
		</div>

		<script>
			document.querySelector('.navbar').style.backgroundColor = 'black';
			document.querySelector('form').style.marginTop = '10rem';
			document.querySelector('form').style.marginBottom = '4.5rem';

			const form = document.querySelector('form');
			const emailError = document.querySelector('.email.error');
			const passwordError = document.querySelector('.password.error');

			form.addEventListener('submit', async (e) => {
				e.preventDefault();

				//reset error
				emailError.textContent = '';
				passwordError.textContent = '';

				const email = form.email.value;
				const password = form.password.value;

				try {
					const res = await fetch('/login', {
						method: 'POST',
						body: JSON.stringify({ email, password }),
						headers: { 'Content-Type': 'application/json' },
					});
					const data = await res.json();
					console.log(data);
					if (data.errors) {
						emailError.textContent = data.errors.email;
						passwordError.textContent = data.errors.password;
					}
					if (data.user) {
						location.assign('/');
					}
				} catch (err) {
					console.log(err);
				}
			});
		</script>
		<%- include('./partials/footer.ejs') %>
	</body>
</html>
